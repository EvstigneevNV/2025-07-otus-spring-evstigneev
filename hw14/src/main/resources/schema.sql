DROP TABLE IF EXISTS books_genres;
DROP TABLE IF EXISTS comment;
DROP TABLE IF EXISTS book;
DROP TABLE IF EXISTS genre;
DROP TABLE IF EXISTS author;

CREATE TABLE author (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    full_name VARCHAR(255) NOT NULL
);

CREATE TABLE genre (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL
);

CREATE TABLE book (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    author_id BIGINT,
    CONSTRAINT fk_book_author FOREIGN KEY (author_id) REFERENCES author(id)
);

CREATE TABLE books_genres (
    book BIGINT NOT NULL,
    genre BIGINT NOT NULL,
    CONSTRAINT fk_bg_book FOREIGN KEY (book) REFERENCES book(id),
    CONSTRAINT fk_bg_genre FOREIGN KEY (genre) REFERENCES genre(id),
    PRIMARY KEY (book, genre)
);

CREATE TABLE comment (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    text VARCHAR(1024) NOT NULL,
    book_id BIGINT,
    CONSTRAINT fk_comment_book FOREIGN KEY (book_id) REFERENCES book(id)
);
